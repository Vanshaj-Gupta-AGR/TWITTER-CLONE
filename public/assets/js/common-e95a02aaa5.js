function timeDifference(t,e){var a=6e4,n=36e5,s=864e5,o=2592e6,i=31536e6,r=t-e;return r<a?r/1e3<30?"just now":Math.round(r/1e3)+" seconds ago":r<n?Math.round(r/a)+" minutes ago":r<s?Math.round(r/n)+" hours ago":r<o?Math.round(r/s)+" days ago":r<i?Math.round(r/o)+" months ago":Math.round(r/i)+" years ago"}let user3;function output(t,e){e.html(""),Array.isArray(t)||(t=[t]),t.forEach((t=>{var a=createPostHtml(t);e.append(a)}))}function getid(t){var e=t.hasClass("post")?t:t.closest(".post");return console.log(e),e.data().id}function refreshMessage(){console.log("okay5"),$.post("/old/oops",{unreadOnly:!0},(t=>{var e=t.results.length;e>0?$("#messagesBadge").text(e).addClass("active"):$("#messagesBadge").text("").removeClass("active")}))}function refreshNotification(){$.get("/notifications/getall",{unreadOnly:!0},(t=>{var e=t.length;e>0?$("#notificationBadge").text(e).addClass("active"):$("#notificationBadge").text("").removeClass("active")}))}function createPostHtml(t){if(null==t)return alert("fuck you");var e=null!=t.retweetData,a=e?t.user.name:null,n=(t=e?t.retweetData:t).user;if(null==n._id)return console.log("why the fuck are you here");var s=timeDifference(new Date,new Date(t.createdAt)),o=t.retweetUsers.includes(user)?"active":"",i=t.likes.includes(user)?"active":"",r="";e&&(r=`<span> Retweeted by <a href="/profile/${a}">@${a}</a></span>`);var l="",d="";t.replyTo?l=`<span> Replying To <a href="/profile/${t.replyTo.user.name}">${t.replyTo.user.name}</a></span>`:d=`<div class="postFotter">\n        <div class="postButtonContainer">\n            <button data-toggle='modal' data-target="#replyModal">\n              <i class='far fa-comment'></i>\n            </button>\n            \n\n        </div>\n        <div class="postButtonContainer green">\n            <button class="retweetbutton  ${o}">\n              <i class='fas fa-retweet'></i>\n              <span>${t.retweetUsers.length||""}</span>\n            </button>\n            \n\n        </div>\n        <div class="postButtonContainer red">\n            <button class="likebutton ${i}">\n              <i class='far fa-heart'></i>\n              <span>${t.likes.length||""}</span>\n            </button>\n            \n\n        </div>\n    </div>`;var c="",u="";if(t.user._id==user){var p="",$="#confirmPinModal";1==t.pinned&&(p="active",$="#unpinModal",u="<i class='fas fa-thumbtack'></i> <span>Pinned Post</span>"),c=`<button class="pinButton ${p}" data-id="${t._id}" data-toggle="modal" data-target="${$}"><i class="fas fa-thumbtack"></i></button>\n            <button data-id="${t._id}" data-toggle="modal" data-target="#deletePostModal"><i class="fas fa-times"></i></button>`}return`<div class="post" data-id="${t._id}">\n                <div class="postActionContainer">\n                    ${r}\n                </div>\n               \n                <div class="postActionContainer">\n                ${l}\n                </div>\n\n                <div class="mainContentContainer">\n                 <div class="userImageContainer">\n                  <img src="${n.profilePic}">\n                  </div>\n                  <div class="postContentContainer">\n                  <div class="pinnedPostText">${u}</div>\n                    <div class="header">\n                    <a class="displayname" href="/users/profile/${n._id}">${n.name}</a>\n                    <span class="username">@${n.name}</span>\n                    <span class="date">${s}</span>\n                    ${c}\n                    </div>\n\n                    <div class="postBody">\n                        <span>${t.content}</span>\n                        </div>\n\n                    ${d}\n\n                    \n\n                   \n                  </div>\n                </div>\n                </div>`}function showpopup(t){var e=createnoty(t),a=$(e);a.hide().prependTo(".notificationList").slideDown("fast"),console.log(e),setTimeout((()=>a.fadeOut(400)),5e3)}$(document).ready((()=>{refreshMessage(),refreshNotification()})),$("#posttextarea, #replytextarea").keyup((t=>{var e=$(t.target),a=e.val().trim(),n=1==e.parents(".modal").length?$("#submitReplyButton"):$("#submitpost");""==a?""!=a||n.prop("disabled",!0):n.prop("disabled",!1)})),$("#submitpost, #submitReplyButton").click((t=>{var e=$(t.target),a=1==e.parents(".modal").length,n=a?$("#replytextarea"):$("#posttextarea"),s={content:n.val()},o="";a&&(o=e.data().id,s.replyTo=o),$.post("/api/posts",s,((t,a,s)=>{if(t.replyTo)emitNotification(t.replyTo.user),location.reload();else{console.log(t);var o=createPostHtml(t);$(".postsContainer").prepend(o),n.val(""),e.prop("disabled",!0)}}))})),$("#replyModal").on("show.bs.modal",(t=>{var e=getid($(t.relatedTarget));$("#submitReplyButton").data("id",e),$.get("/api/posts/"+e,(t=>{output(t,$("#originalPost"))}))})),$("#deletePostModal").on("show.bs.modal",(t=>{var e=getid($(t.relatedTarget));console.log(e),$("#deletePostButton").data("id",e)})),$("#confirmPinModal").on("show.bs.modal",(t=>{var e=getid($(t.relatedTarget));$("#confirmPinButton").data("id",e)})),$("#unpinModal").on("show.bs.modal",(t=>{var e=getid($(t.relatedTarget));$("#unpinButton").data("id",e)})),$("#deletePostButton").click((t=>{var e=$(t.target).data("id");$.ajax({url:`/api/posts/${e}`,type:"delete",success:()=>{location.reload()}})})),$("#confirmPinButton").click((t=>{var e=$(t.target).data("id");$.ajax({url:`/api/posts/${e}/pin`,type:"put",data:{pinned:!0},success:()=>{location.reload()}})})),$("#unpinButton").click((t=>{var e=$(t.target).data("id");$.ajax({url:`/api/posts/${e}/unpin`,type:"put",data:{pinned:!1},success:()=>{location.reload()}})})),$("#replyModal").on("hidden.bs.modal",(t=>{$("#originalPost").html=""})),$(document).on("click",".likebutton",(t=>{var e=$(t.target),a=getid(e);$.ajax({url:`/api/posts/${a}/like`,type:"PUT",success:t=>{e.find("span").text(t.likes.length||""),t.likes.includes(user)?(e.addClass("active"),emitNotification(t.user)):e.removeClass("active")}})})),$(document).on("click",".retweetbutton",(t=>{var e=$(t.target),a=getid(e);$.ajax({url:`/api/posts/${a}/retweet`,type:"POST",success:t=>{console.log(t),e.find("span").text(t.retweetUsers.length||""),t.retweetUsers.includes(user)?(e.addClass("active"),emitNotification(t.user)):e.removeClass("active")}})}));