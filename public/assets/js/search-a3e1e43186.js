var timer,user;function search(n,e){var t="users"==e?"/api/us/sr":"/api/ps/sr";console.log(t),console.log(n,e),$.ajax({url:t,type:"post",data:{obj:n},success:n=>{"users"==e?outputUsers(n.result,$(".resultsContainer")):outputPosts(n,$(".resultsContainer"))}})}function timeDifference(n,e){var t=6e4,a=36e5,s=864e5,o=2592e6,r=31536e6,i=n-e;return i<t?i/1e3<30?"just now":Math.round(i/1e3)+" seconds ago":i<a?Math.round(i/t)+" minutes ago":i<s?Math.round(i/a)+" hours ago":i<o?Math.round(i/s)+" days ago":i<r?Math.round(i/o)+" months ago":Math.round(i/r)+" years ago"}function outputPosts(n,e){e.html(""),Array.isArray(n)||(n=[n]),n.forEach((n=>{var t=createPostHtml(n);e.append(t)})),0==n.length&&e.append("<span class='noResults'>Nothing to show.</span>")}function createPostHtml(n){if(null==n)return alert("fuck you");var e=null!=n.retweetData,t=e?n.user.name:null,a=(n=e?n.retweetData:n).user;if(null==a._id)return console.log("why the fuck are you here");var s=timeDifference(new Date,new Date(n.createdAt)),o=n.retweetUsers.includes(user)?"active":"",r=n.likes.includes(user)?"active":"",i="";e&&(i=`<span> Retweeted by <a href="/profile/${t}">@${t}</a></span>`);var l="",u="";n.replyTo?l=`<span> Replying To <a href="/profile/${n.replyTo.user.name}">${n.replyTo.user.name}</a></span>`:u=`<div class="postFotter">\n        <div class="postButtonContainer">\n            <button data-toggle='modal' data-target="#replyModal">\n              <i class='far fa-comment'></i>\n            </button>\n            \n\n        </div>\n        <div class="postButtonContainer green">\n            <button class="retweetbutton  ${o}">\n              <i class='fas fa-retweet'></i>\n              <span>${n.retweetUsers.length||""}</span>\n            </button>\n            \n\n        </div>\n        <div class="postButtonContainer red">\n            <button class="likebutton ${r}">\n              <i class='far fa-heart'></i>\n              <span>${n.likes.length||""}</span>\n            </button>\n            \n\n        </div>\n    </div>`;var d="",c="";if(n.user._id==user){var p="",f="#confirmPinModal";1==n.pinned&&(p="active",f="#unpinModal",c="<i class='fas fa-thumbtack'></i> <span>Pinned Post</span>"),d=`<button class="pinButton ${p}" data-id="${n._id}" data-toggle="modal" data-target="${f}"><i class="fas fa-thumbtack"></i></button>\n            <button data-id="${n._id}" data-toggle="modal" data-target="#deletePostModal"><i class="fas fa-times"></i></button>`}return`<div class="post" data-id="${n._id}">\n                <div class="postActionContainer">\n                    ${i}\n                </div>\n               \n                <div class="postActionContainer">\n                ${l}\n                </div>\n\n                <div class="mainContentContainer">\n                 <div class="userImageContainer">\n                  <img src="${a.profilePic}">\n                  </div>\n                  <div class="postContentContainer">\n                  <div class="pinnedPostText">${c}</div>\n                    <div class="header">\n                    <a class="displayname" href="/users/profile/${a._id}">${a.name}</a>\n                    <span class="username">@${a.name}</span>\n                    <span class="date">${s}</span>\n                    ${d}\n                    </div>\n\n                    <div class="postBody">\n                        <span>${n.content}</span>\n                        </div>\n\n                    ${u}\n\n                    \n\n                   \n                  </div>\n                </div>\n                </div>`}function outputUsers(n,e){e.html(""),n.forEach((n=>{var t=createUserHtml(n,!0);e.append(t)})),0==n.length&&e.append("<span class='noResults'>No results found</span>")}function createUserHtml(n,e){console.log(n.name);var t=n.name,a=user.following&&user.following.includes(n._id),s=a?"Following":"Follow",o=a?"followButton following":"followButton",r="";return e&&user._id!=n._id&&(r=`<div class='followButtonContainer'>\n                            <button class='${o}' data-user='${n._id}'>${s}</button>\n                        </div>`),`<div class='user'>\n                <div class='userImageContainer'>\n                    <img src='${n.profilePic}'>\n                </div>\n                <div class='userDetailsContainer'>\n                    <div class='header'>\n                        <a href='/users/profile/${n._id}'>${t}</a>\n                        <span class='username'>@${n.name}</span>\n                    </div>\n                </div>\n                ${r}\n            </div>`}$(document).ready((()=>{$.get("/u",(n=>{user=n,console.log(user)}))})),$("#searchBox").keydown((n=>{clearTimeout(timer);var e=$(n.target),t=e.val(),a=e.data().search;timer=setTimeout((()=>{""==(t=e.val().trim())?$(".resultsContainer").html(""):search(t,a)}),1e3)})),$(document).on("click",".followButton",(n=>{var e=$(n.target),t=e.data().user;$.ajax({url:`/api/users/${t}/follow`,type:"put",success:(n,a,s)=>{if(404!=s.status){var o=1;n.following&&n.following.includes(t)?(e.addClass("following"),e.text("following")):(e.removeClass("following"),e.text("follow"),o=-1);var r=$("#followersValue");if(0!=r.length){var i=r.text();i=parseInt(i),r.text(i+o)}}}})}));