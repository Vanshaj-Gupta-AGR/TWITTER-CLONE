var cropper;function loadposts(){$.get("/api/users/"+user,(t=>{output(t,$(".postsContainer"))}))}function timeDifference(t,e){var a=6e4,n=36e5,o=864e5,s=2592e6,r=31536e6,i=t-e;return i<a?i/1e3<30?"just now":Math.round(i/1e3)+" seconds ago":i<n?Math.round(i/a)+" minutes ago":i<o?Math.round(i/n)+" hours ago":i<s?Math.round(i/o)+" days ago":i<r?Math.round(i/s)+" months ago":Math.round(i/r)+" years ago"}let user3;function output(t,e){e.html(""),Array.isArray(t)||(t=[t]),t.forEach((t=>{var a=createPostHtml(t);e.append(a)}))}function getid(t){return(t.hasClass("post")?t:t.closest(".post")).data().id}function createPostHtml(t){if(null==t)return alert("fuck you");var e=null!=t.retweetData,a=e?t.user.name:null,n=(t=e?t.retweetData:t).user;if(null==n._id)return console.log("why the fuck are you here");var o=timeDifference(new Date,new Date(t.createdAt)),s=t.retweetUsers.includes(user)?"active":"",r=t.likes.includes(user)?"active":"",i="";e&&(i=`<span> Retweeted by <a href="/profile/${a}">@${a}</a></span>`);var l="",d="";t.replyTo?l=`<span> Replying To <a href="/profile/${t.replyTo.user.name}">${t.replyTo.user.name}</a></span>`:d=`<div class="postFotter">\n        <div class="postButtonContainer">\n            <button class="hello" data-id="${t._id}" data-toggle='modal' data-target="#replyModal">\n              <i class='far fa-comment'></i>\n            </button>\n            \n\n        </div>\n        <div class="postButtonContainer green">\n            <button class="retweetbutton  ${s}">\n              <i class='fas fa-retweet'></i>\n              <span>${t.retweetUsers.length||""}</span>\n            </button>\n            \n\n        </div>\n        <div class="postButtonContainer red">\n            <button class="likebutton ${r}">\n              <i class='far fa-heart'></i>\n              <span>${t.likes.length||""}</span>\n            </button>\n            \n\n        </div>\n    </div>`;var c="",p="";if(t.user._id==user){var u="",v="#confirmPinModal";1==t.pinned&&(u="active",v="#unpinModal",p="<i class='fas fa-thumbtack'></i> <span>Pinned Post</span>"),c=`<button class="pinButton temp2 ${u}" data-id="${t._id}" data-toggle="modal" data-target="${v}"><i class="fas fa-thumbtack"></i></button>\n            <button class="temp" data-id="${t._id}" data-toggle="modal" data-target="#deletePostModalagain"><i class="fas fa-times"></i></button>`}return`<div class="post" data-id="${t._id}">\n                <div class="postActionContainer">\n                    ${i}\n                </div>\n               \n                <div class="postActionContainer">\n                ${l}\n                </div>\n\n                <div class="mainContentContainer">\n                 <div class="userImageContainer">\n                  <img src="${n.profilePic}">\n                  </div>\n                  <div class="postContentContainer">\n                  <div class="pinnedPostText">${p}</div>\n                    <div class="header">\n                    <a class="displayname" href="/users/profile/${n._id}">${n.name}</a>\n                    <span class="username">@${n.name}</span>\n                    <span class="date">${o}</span>\n                    ${c}\n                    </div>\n\n                    <div class="postBody">\n                        <span>${t.content}</span>\n                        </div>\n\n                    ${d}\n\n                    \n\n                   \n                  </div>\n                </div>\n                </div>`}$(document).ready((()=>{loadposts()})),$(document).on("click",".followButton",(t=>{var e=$(t.target),a=e.data().user;$.ajax({url:`/api/users/${a}/follow`,type:"put",success:(t,n,o)=>{if(404!=o.status){var s=1;t.following&&t.following.includes(a)?(e.addClass("following"),e.text("following")):(e.removeClass("following"),e.text("follow"),s=-1);var r=$("#followersValue");if(0!=r.length){var i=r.text();i=parseInt(i),r.text(i+s)}}}})})),$("#filephoto").change((function(){if(this.files&&this.files[0]){var t=new FileReader;t.onload=t=>{var e=document.getElementById("imagePreview");$("#imagePreview").attr("src",t.target.result),void 0!==cropper&&cropper.destroy(),cropper=new Cropper(e,{aspectRatio:1,background:!1})},t.readAsDataURL(this.files[0])}})),$("#imageUploadButton").click((function(){var t=cropper.getCroppedCanvas();if(null==t)return alert("oye");t.toBlob((t=>{var e=new FormData;e.append("croppedImage",t),console.log(e),$.ajax({url:"/api/users/upload",type:"post",data:e,processData:!1,contentType:!1,success:t=>{location.reload()}})}))})),$("#Coverphoto").change((function(){if(this.files&&this.files[0]){var t=new FileReader;t.onload=t=>{var e=document.getElementById("coverPreview");$("#coverPreview").attr("src",t.target.result),void 0!==cropper&&cropper.destroy(),cropper=new Cropper(e,{aspectRatio:16/9,background:!1})},t.readAsDataURL(this.files[0])}})),$("#CoverButton").click((function(){var t=cropper.getCroppedCanvas();if(null==t)return alert("oye");t.toBlob((t=>{var e=new FormData;e.append("croppedImage",t),console.log(e),$.ajax({url:"/api/users/upload/cover",type:"post",data:e,processData:!1,contentType:!1,success:t=>{location.reload()}})}))})),$("#submitReplyButton").click((t=>{var e=$(t.target);console.log(e);var a=1==e.parents(".modal").length,n=a?$("#replytextarea"):$("#posttextarea"),o={content:n.val()},s="";a&&(s=e.data().id,o.replyTo=s),$.post("/api/posts",o,((t,a,o)=>{if(t.replyTo)location.reload();else{console.log(t);var s=createPostHtml(t);$(".postsContainer").prepend(s),n.val(""),e.prop("disabled",!0)}}))})),$(document).on("click",".hello",(t=>{var e=t.target.getAttribute("data-id");$("#submitReplyButton").data("id",e),$.get("/api/posts/"+e,(t=>{output(t,$("#originalPost"))}))})),$("#posttextarea, #replytextarea").keyup((t=>{var e=$(t.target),a=e.val().trim(),n=1==e.parents(".modal").length?$("#submitReplyButton"):$("#submitpost");""==a?""!=a||n.prop("disabled",!0):n.prop("disabled",!1)})),$(document).on("click",".temp",(t=>{var e=t.target.getAttribute("data-id");$("#deletePostButton").data("id",e)})),$(document).on("click",".temp2",(t=>{var e=t.target.getAttribute("data-id");$("#confirmPinButton").data("id",e)})),$(document).on("click",".temp2",(t=>{var e=t.target.getAttribute("data-id");$("#unpinButton").data("id",e)})),$("#deletePostButton").click((t=>{var e=$(t.target).data("id");console.log(e),$.ajax({url:`/api/posts/${e}`,type:"delete",success:()=>{location.reload()}})})),$("#confirmPinButton").click((t=>{console.log(t.target);var e=$(t.target).data("id");console.log(e),$.ajax({url:`/api/posts/${e}/pin`,type:"put",data:{pinned:!0},success:()=>{location.reload()}})})),$("#unpinButton").click((t=>{var e=$(t.target).data("id");$.ajax({url:`/api/posts/${e}/unpin`,type:"put",data:{pinned:!1},success:()=>{location.reload()}})})),$("#replyModal").on("hidden.bs.modal",(t=>{$("#originalPost").html=""})),$(document).on("click",".likebutton",(t=>{var e=$(t.target),a=getid(e);$.ajax({url:`/api/posts/${a}/like`,type:"PUT",success:t=>{e.find("span").text(t.likes.length||""),t.likes.includes(user)?(e.addClass("active"),emitNotification(t.user)):e.removeClass("active")}})})),$(document).on("click",".retweetbutton",(t=>{var e=$(t.target),a=getid(e);$.ajax({url:`/api/posts/${a}/retweet`,type:"POST",success:t=>{console.log(t),e.find("span").text(t.retweetUsers.length||""),t.retweetUsers.includes(user)?(e.addClass("active"),emitNotification(t.user)):e.removeClass("active")}})}));